# Change Log

All notable changes to this project will be documented in this file
automatically by Versionist. DO NOT EDIT THIS FILE MANUALLY!
This project adheres to [Semantic Versioning](http://semver.org/).

## 0.1.0 - 2021-04-07

* Create poc for the balena-compose library and cli [Robert G√ºnzler, Pagan Gazzard, PJ Zoulin, Stathis Moraitidis, Felipe Lalanne]
* typos: seperate -> separate [Matthew McGinn]
* Infer legacy Volumes that do not have the supervised label [Miguel Casqueira]
* Refactor checkTruthy to return more predictable values [Miguel Casqueira]
* Complete /v1/device/host-config unit tests, modify PATCH route [Christina Wang]
* Patch killServicesUsingApi to not get stuck in noop loop [Miguel Casqueira]
* Fix gpu label support [Robert G√ºnzler]
* Add support for `BALENA_HOST_SPLASH_IMAGE` config [Felipe Lalanne]
* Improve supervisor API behavior when locks are set [Felipe Lalanne]
* validation: Ensure commit lookup has a bound value [Rich Bayliss]
* Allow storing commits against their appIds [Cameron Diver]
* Mount docker socket under `/host/run` for services [Felipe Lalanne]
* Change log source from docker to journalctl [Thomas Manning]
* Fixed evaluating if updates are needed to reach target state [Miguel Casqueira]
* Improved log message when networks do not match [Miguel Casqueira]
* Handle delete of multiple images with same dockerImageId [Felipe Lalanne]
* Add features label `io.balena.features.journal-logs` [Thomas Manning]
* version: drop SUPERVISOR_VERSION env var [Matthew McGinn]
* api: Implement scoped Supervisor API keys [Rich Bayliss]
* application-manager: Convert to a singleton [Rich Bayliss]
* Update typed-error to 3.x [Pagan Gazzard]
* fix matching extra_uEnv backend with unsupported devices [Miguel Casqueira]
* Support setting device/fleet configuration in extra_uEnv.txt [Miguel Casqueira]
* Extract current state reporting to its own module [Pagan Gazzard]
* Fix docker-util using incorrect reference for function [Miguel Casqueira]
* state: Report device MAC address to the API [Rich Bayliss]
* Make service-manager module a singleton [Cameron Diver]
* Make volume-manager module a singleton [Cameron Diver]
* Make network-manager module a singleton [Cameron Diver]
* Add label to expose gpu to container [Robert G√ºnzler]
* Move database app processing out to its own module [Cameron Diver]
* Make images module a singleton [Cameron Diver]
* Make logger module a singleton [Cameron Diver]
* Make the event-tracker module a singleton [Cameron Diver]
* Make docker module a singleton [Cameron Diver]
* Make the config module a singleton [Cameron Diver]
* Update dependencies [Pagan Gazzard]
* Make the db module a singleton [Cameron Diver]
* Fix default request options [Pagan Gazzard]
* Update to @balena/lint 5.x [Pagan Gazzard]
* Add a random offset to the poll interval with each poll [Cameron Diver]
* Correctly check if value is a valid Integer [Miguel Casqueira]
* üìÑ Upgrade knex to avoid CVE-2019-10757 [Cameron Diver]
* üöÄ Update supervisor to node12 [Cameron Diver]
* Convert application-manager.coffee to javascript [Pagan Gazzard]
* Allow spaces in volume definitions [Cameron Diver]
* Convert test/18-compose-network.coffee to javascript [Pagan Gazzard]
* Convert test/16-ports.spec.coffee to typescript [Pagan Gazzard]
* Add BALENA_DEVICE_ARCH environment variable for containers [Cameron Diver]
* Convert proxyvisor to javascript [Pagan Gazzard]
* Switch to a named export for application-manager [Pagan Gazzard]
* Convert device-api/v1 to javascript [Pagan Gazzard]
* Add type checking for javascript files [Pagan Gazzard]
* Update dependencies [Cameron Diver]
* logging: fix up some typos [Matthew McGinn]
* Convert device-state module to typescript [Cameron Diver]
* Improve and extend internal typings [Cameron Diver]
* Add procfs label [Cameron Diver]
* Add a sysfs feature label [Cameron Diver]
* Clean up the feature label function [Cameron Diver]
* bug: Delay sending logs until the device is provisioned [Rich Bayliss]
* Update lodash types [Pagan Gazzard]
* Update types and fix issue with treating string as a number [Pagan Gazzard]
* Throttle state report patches to once per 10 seconds [Cameron Diver]
* Report the correct error when we cannot remove a network [Cameron Diver]
* fix: ‚¨áÔ∏è Force a regular pull when moving from v2 to v3 deltas [Cameron Diver]
* Always filter environment configuration [Cameron Diver]
* volumes: Allow the use of the 'driver' setting in volumes [Rich Bayliss]
* Define the database type of the application [Cameron Diver]
* Extract loadTargetFromFile function to preload module [Cameron Diver]
* Define TargetApplicationState in types and remove Application type [Cameron Diver]
* Convert some coffeescript tests to typescript [Cameron Diver]
* Add support for container contracts [Cameron Diver]
* Upgrade io-ts and fp-ts to 2.0.0 [Cameron Diver]
* Avoid synchronous file accesses for os release info [Cameron Diver]
* Correctly handle partial IPAM configurations for networks [Cameron Diver]
* Extract composition step work out to typescript compose module [Cameron Diver]
* Remove unused local mode parameter from images.getAvailable [Cameron Diver]
* Only consider certain array fields without order [Cameron Diver]
* Take order into account when comparing service config arrays [Cameron Diver]
* Prevent supervisor from deleting itself [Roman Mazur]
* Support network_modes of service:<servicename> [Cameron Diver]
* fix: Don't consider volume supervised labels when comparing [Cameron Diver]
* Don't attempt to cleanup any target state referenced volumes [Cameron Diver]
* Add a supervisor endpoint to cleanup orphaned volumes [Cameron Diver]
* Don't attempt to setup a log stream to the cloud before provision [Cameron Diver]
* Add more typescript conversions and export utilities from existing [Cameron Diver]
* Fix network composition parsing, and correctly report compose config [Cameron Diver]
* Keep the network and volume models consistent across usage [Cameron Diver]
* Seperate volume handling into manager and object classes [Cameron Diver]
* Fix typo in image selection [Cameron Diver]
* Re-parallelise current image retrieval code [Cameron Diver]
* Upgrade typescript and fix warnings [Cameron Diver]
* Standardise all supervisor output logging [Cameron Diver]
* Add wrapper around container logs saving, to reduce db load [Cameron Diver]
* Move to resin-lint 3 and fix lint errors [Cameron Diver]
* Make delta application logs easier to parse for multicontainer [Cameron Diver]
* Cache delta auth token request results for 10 minutes [Cameron Diver]
* Perform case-insensitive checking when converting booleans from strings [Cameron Diver]
* fix: Correctly handle multiple hosts ports pointing to a container port [Cameron Diver]
* compose: Remove unique expose entries after adding all entries [Cameron Diver]
* types: Upgrade dockerode types, and remove fixes which are superceded [Cameron Diver]
* Report all logs from a container's runtime [Cameron Diver]
* Refactor container logging interface and rename logging-backends [Cameron Diver]
* ux: Remove service already running log message [Cameron Diver]
* Fix service comparison when starting a stopped service [Cameron Diver]
* Fix typo in delta request error message [Cameron Diver]
* fix: Correctly compare and generate network membership aliases [Cameron Diver]
* events: Allow system messages to not be tracked [Cameron Diver]
* Ensure the supervisor0 network uses a subnet less likely to cause conflicts [Pablo Carranza Velez]
* feature: Add `BALENA_API_URL` environment variable when using the `balena-api` feature label [Rich Bayliss]
* Improve error messages, and add description to ImageAuth error [Cameron Diver]
* fix: Request image authentication token with explicitly as json [Cameron Diver]
* Always back off on image fetch failure [Cameron Diver]
* Allow newlines to be part of environment variables [Cameron Diver]
* Remove environment variable whitespace trimming [Cameron Diver]
* Set default delta apply timeout of 0 [Cameron Diver]
* fix: Normalize ports from compose file on instantiation [Cameron Diver]
* Make the failure backoff time the same as the appUpdatePollTime [Cameron Diver]
* Backoff on image download error [Cameron Diver]
* fix: Don't attempt a pull if the token requests fails [Cameron Diver]
* Add missing ServiceManager methods [Cameron Diver]
* refactor: Convert ServiceManager to typescript [Cameron Diver]
* Improve error and logger typings [Cameron Diver]
* refactor: Convert docker-utils module to typescript [Cameron Diver]
* Clear up images.ts module code for simiplicity [Cameron Diver]
* refactor: Convert volumes module to typescript [Cameron Diver]
* refactor: Convert compose/images module to typescript [Cameron Diver]
* misc: Add Nullable<T> helper type [Cameron Diver]
* refactor: Remove unnecessary validations and casts [Cameron Diver]
* refactor: Convert ApiBinder module to typescript [Cameron Diver]
* refactor: Only promisify read and write locks once [Cameron Diver]
* refactor: Generate and normalise PortMaps from compose ports in-class [Cameron Diver]
* compose: Normalise target ports for comparison with docker's output [Cameron Diver]
* types: Make DeviceApplicationState reflect state endpoint [Cameron Diver]
* refactor: Add default export to logger module [Cameron Diver]
* fix: Correctly type top level network IPAM config [Cameron Diver]
* refactor: Convert update-lock module to typescript [Cameron Diver]
* refactor: Convert systemd module to typescript [Cameron Diver]
* refactor: Convert request module to typescript [Cameron Diver]
* refactor: Convert migration module to typescript [Cameron Diver]
* config: Replace supervisorOfflineMode and offlineMode with unmanaged [Cameron Diver]
* Add the ability to restore volumes from a backup.tgz in the data partition [Pablo Carranza Velez]
* Fix typo that prevented deleting old resin/ supervisor images [Pablo Carranza Velez]
* compose: Fix network option field names and update dockerode types [Cameron Diver]
* device-api: Add container id endpoint [Cameron Diver]
* compose: Set default config for stopSignal to SIGTERM [Shaun Mulligan]
* compose: Change default stop signal from '' to SIGTERM [Shaun Mulligan]
* compose: Change default grace period to 10s [Cameron Diver]
* Remove some type casts [Pagan Gazzard]
* Update to typescript 3 [Pagan Gazzard]
* Remove unused codepaths that do deltas from resin/scratch [Pablo Carranza Velez]
* Rename most of the documentation and variable names from resin to balena [Pablo Carranza Velez]
* When updating from resin-supervisor to balena-supervisor, try to delete old resin-supervisor images [Pablo Carranza Velez]
* fix: Properly check for the balena-api label to inject the API key env vars [Pablo Carranza Velez]
* Keep defaulting tty to true to avoid accidental breakage [Pablo Carranza Velez]
* deviceConfig: allow BALENA_ config variables [Pablo Carranza Velez]
* fix: Add typescript cast to fix type error [Cameron Diver]
* fix: Always set the container name when generating creation options [Cameron Diver]
* Use the DOCKER_SOCKET env var for the user container's balena socket mount [Pablo Carranza Velez]
* service: Fix device name env vars by injecting and filtering in the interface with docker [Pablo Carranza Velez]
* ServiceManager: add BALENA_DEVICE_NAME_AT_INIT to injected env vars [Pablo Carranza Velez]
* Replace io.resin labels (and their env vars) with io.balena equivalents [Pablo Carranza Velez]
* Make handover-complete an alternative to the resin-kill-me file [Pablo Carranza Velez]
* Move the handover and lock files to /tmp/balena, rename them, and add BALENA_ env vars [Pablo Carranza Velez]
* fix: overlay compose fields on image for healthcheck [Cameron Diver]
* fix: Remove support for broken storageOpt option [Cameron Diver]
* fix: Don't assume config is defined for legacy images in logger [Cameron Diver]
* logger: Enforce timestamp value to avoid logging server 400 errors [Cameron Diver]
* Add logging endpoint to supervisor [Cameron Diver]
* Support local logging via standard logging interface [Cameron Diver]
* Support setting target state in local mode from supervisor API [Cameron Diver]
* fix: Correctly handle array based network definitions for service [Cameron Diver]
* fix: Only join the default network when creating the container [Cameron Diver]
* compose: Support changing the tty option for compose services [Cameron Diver]
* types: Remove temporary Service type in favour of actual compose class [Cameron Diver]
* compose/service: Convert module to typescript and add network config [Cameron Diver]
* Compose: Support more network creation options [Cameron Diver]
* Refactor: Split Networks class to Network and NetworkManager [Cameron Diver]
* logger: Fix reporting the configuration change variables [Cameron Diver]
* refactor: Use Dictionary<T> type in ports module [Cameron Diver]
* fix: Respect logging enabling on instantiation of logger [Cameron Diver]
* Refactor: Convert logging module to typescript [Cameron Diver]
* types: Add global typings file containing Dictionary<T> type [Cameron Diver]
* Refactor: Make exported log-types implement interface [Cameron Diver]
* fix: Dont bind service class methods in declaration [Cameron Diver]
* ux: Warn on invalid device name when trying to start a service [Cameron Diver]
* Refactor: Convert log-types module to typescript [Cameron Diver]
* fix: Apply device name before generating container config [Cameron Diver]
* Fix: Restart a service when it's memory limit changes [Cameron Diver]
* Fix: Fix scoping issue with variables in service-manager [Cameron Diver]
* Dont restart service on device name change [Cameron Diver]
* logger: Remove pubnub leftovers [Petros Angelatos]
* Remove resinApiEndpoint meta-endpoint and use config.json entry instead [Cameron Diver]
* Add applications state v2 endpoint [Cameron Diver]
* Move compose types to ./types and add partial definitions for compose modules [Cameron Diver]
* Add fromDockerOpts and normalization to PortMap class, and use in fromContainer [Cameron Diver]
* Store port ranges as ranges, to reduce memory usage [Cameron Diver]
* Convert fs-utils module to typescript [Cameron Diver]
* Show better UX when a delta download fails because the image is processing [Cameron Diver]
* Move config backend code out to classes which implement a common base [Cameron Diver]
* Move boot config related code to config-utils module [Cameron Diver]
* Add support for Balena deltas [Akis Kesoglou]
* Ignore leading and trailing whitespace when parsing env vars [Cameron Diver]
* Convert conversions module to typescript [Cameron Diver]
* Move shared types to separate module [Cameron Diver]
* Convert lib/constants module to typescript [Cameron Diver]
* Type parameters for validation functions better [Cameron Diver]
* Remove trailing slashes from working directories of services [Cameron Diver]
* Start initial typescript conversion, and add validation debugging [Cameron Diver]
* On startup, only attach to logs for running containers, and remove any containers marked as dead [Pablo Carranza Velez]
* Allow services (and their images) to expose udp ports besides tcp [Pablo Carranza Velez]
* Fix regex for parsing memory numbers [Cameron Diver]
* Avoid trying to clean up the supervisor image if it has several tags (even though it would never succeed) [Pablo Carranza Velez]
* compose: Use the hostname on the host as default hostname for services with host network mode [Pablo Carranza Velez]
* Pass the correct working_dir to the container config, and compare containers for working dir changes [Pablo Carranza Velez]
* compose: Emit a change event when a container is renamed, so that the updated imageId and releaseId are reported [Pablo Carranza Velez]
* compose: fix type error, createVolume returns a promise [Petros Angelatos]
* compose: fix volume migration code [Petros Angelatos]
* Implement a new logger that sends logs to the resin API, that can be used optionally instead of PubNub [Pablo Carranza Velez]
* Fix the way commands and entrypoints in string form are parsed [Pablo Carranza Velez]
* Use a supervisor0 network interface for the supervisor network API. Remove RESIN_APP_COMMIT and RESIN_APP_RELEASE env vars. [Pablo Carranza Velez]
* Remove all bind mounts that were specific to 1.X devices. Move the resin-kill-me file for the handover strategy to /tmp/resin. Add environment variables for the location of resin-kill-me and the lockfile. Use running containers to determine what services are running instead of storing them in the internal database. Use named volumes for persistent data. [Pablo Carranza Velez]
